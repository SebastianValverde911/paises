<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title>Sitios</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- <ion-button style="color: white;margin:10px 0; margin-left: 10px;">Crear sitio</ion-button> -->
   @if (userInfo.role !== 'user') {
    <ion-button id="open-modal" style="color: white;margin:10px 0;margin-left: 10px;">Crear sitio</ion-button>
  }
  <ion-list>
    <ion-item>
      <ion-select label="Escoge un país" placeholder="País" (ionChange)="searchSitioPais($event)">
        @for (pais of paises; track pais.id) {
            <ion-select-option [value]="pais.id">{{ pais.name }}</ion-select-option>
          }
      </ion-select>
    </ion-item>
  </ion-list>
  @for (site of sitios; track site.id) {
    <ion-card>
      <ion-card-header>
        <ion-card-title>{{ site.name }} - {{ site.city_name }}</ion-card-title>
        <ion-card-subtitle>{{ site.type }}</ion-card-subtitle>
      </ion-card-header>

      <ion-card-content>
        {{ site.description }}
      </ion-card-content>
      <div style="display: flex;">
        <ion-button  fill="outline" color="primary" size="default" (click)="registrarVisita(site.id)">Registrar visita</ion-button>
        <ion-button  fill="outline" color="dark" size="default" (click)="registrarPlato(site.id)">Registrar plato</ion-button>
      </div>
    </ion-card>
  }
  <!-- <ion-list>
    <ion-item *ngFor="let site of sites">
      <ion-label>
        <h2>{{ site.name }}</h2>
        <p>{{ site.description }}</p>
      </ion-label>
      <ion-button fill="outline" slot="end" (click)="editSite(site)">Editar</ion-button>
      <ion-button fill="danger" slot="end" (click)="deleteSite(site.id)">Eliminar</ion-button>
    </ion-item> -->

<ion-content class="ion-padding">
  <ion-modal trigger="open-modal" (willDismiss)="onWillDismiss($event)">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="start">
            <ion-button (click)="cancel()">Cancelar</ion-button>
          </ion-buttons>
          <ion-title>Info</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="confirm()" [strong]="true">Confirmar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-item>
          <ion-input
            label="Nombre del sitio"
            labelPlacement="stacked"
            type="text"
            placeholder="Nombre sitio"
            [(ngModel)]="name"
            (ionInput)="onInputChange($event, 'name')"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-input
            label="Tipo de sitio"
            labelPlacement="stacked"
            type="text"
            placeholder="Tipo sitio"
            [(ngModel)]="type"
            (ionInput)="onInputChange($event, 'type')"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-input
            label="Descripcion del sitio"
            labelPlacement="stacked"
            type="text"
            placeholder="Descripción sitio"
            [(ngModel)]="description"
            (ionInput)="onInputChange($event, 'description')"
          ></ion-input>
        </ion-item>
        <ion-item >
          <ion-select
            label="País"
            labelPlacement="stacked"
            placeholder="Selecciona un país"
            [(ngModel)]="countryId"
            (ionChange)="searchCity($event)"
          >
          @for (pais of paises; track pais.id) {
            <ion-select-option [value]="pais.id">{{ pais.name }}</ion-select-option>
          }
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-select
            label="Ciudad"
            labelPlacement="stacked"
            placeholder="Selecciona una ciudad"
            [(ngModel)]="cityId"
          >
             @for (ciudad of ciudades; track ciudad.id) {
            <ion-select-option [value]="ciudad.id">{{ ciudad.name }}</ion-select-option>
          }
          </ion-select>
        </ion-item>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>

<ion-content class="ion-padding">
  <ion-modal #modalVisita (willDismiss)="onWillDismiss($event)">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="start">
            <ion-button (click)="cancelVisita()">Cancelar</ion-button>
          </ion-buttons>
          <ion-title>Visita</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="confirmVisita()" [strong]="true">Confirmar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-item>
          <ion-datetime 
          presentation="date"
          [(ngModel)]="fechaVisita"
          (ionChange)="onFechaChange($event)"
          placeholder="Selecciona una fecha"
          ></ion-datetime>
        </ion-item>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>

<ion-content class="ion-padding">
  <ion-modal  #modalPlato (willDismiss)="onWillDismiss($event)">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="start">
            <ion-button (click)="cancelPlato()">Cancelar</ion-button>
          </ion-buttons>
          <ion-title>Plato</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="confirmPlato()" [strong]="true">Confirmar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-item>
          <ion-input
            label="Nombre del plato"
            labelPlacement="stacked"
            type="text"
            placeholder="Nombre plato"
            [(ngModel)]="platoName"
            (ionInput)="onInputChange($event, 'platoName')"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-input
            label="Precio del plato"
            labelPlacement="stacked"
            type="number"
            placeholder="Precio plato"
            [(ngModel)]="platoPrice"
            (ionInput)="onInputChange($event, 'platoPrice')"
          ></ion-input>
        </ion-item>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
</ion-content>

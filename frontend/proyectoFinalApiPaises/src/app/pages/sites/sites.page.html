<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title>Sitios</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- <ion-button style="color: white;margin:10px 0; margin-left: 10px;">Crear sitio</ion-button> -->
   @if (userInfo.role !== 'user') {
    <ion-button id="open-modal" style="color: white;margin:10px 0;margin-left: 10px;">Crear sitio</ion-button>
  }
  <ion-list>
    <ion-item>
      <ion-select label="Escoge un país" placeholder="País" (ionChange)="searchSitioPais($event)">
        @for (pais of paises; track pais.id) {
            <ion-select-option [value]="pais.id">{{ pais.name }}</ion-select-option>
          }
      </ion-select>
    </ion-item>
  </ion-list>
  @for (site of sitios; track site.id) {
    <ion-card>
      <ion-card-header>
        <div style="display: flex; justify-content: end;">
          <ion-buttons>
            <ion-button (click)="addTag(site.id)" aria-label="tag">
              <ion-icon name="camera-outline" size="large" color="secondary" slot="icon-only" aria-hidden="true"></ion-icon>
            </ion-button>
            <ion-button (click)="addFavorito(site)" aria-label="Favorite">
              <ion-icon color="danger" [name]= "esFavorito(site)? 'heart': 'heart-outline'" slot="icon-only"aria-hidden="true"></ion-icon>
            </ion-button>
          </ion-buttons>
        </div>
        <ion-card-title>{{ site.name }} - {{ site.city_name }}</ion-card-title>
        <ion-card-subtitle>{{ site.type }}</ion-card-subtitle>
      </ion-card-header>

      <ion-card-content>
        {{ site.description }}
      </ion-card-content>
      <div style="display: flex;">
        <ion-button  fill="outline" color="primary" size="default" (click)="registrarVisita(site.id)">Registrar visita</ion-button>
        <ion-button  fill="outline" color="dark" size="default" (click)="registrarPlato(site.id)">Registrar plato</ion-button>
      </div>
    </ion-card>
  }

<ion-content class="ion-padding">
  <ion-modal trigger="open-modal" (willDismiss)="onWillDismiss($event)">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="start">
            <ion-button (click)="cancel()">Cancelar</ion-button>
          </ion-buttons>
          <ion-title>Info</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="confirm()" [strong]="true">Confirmar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-item>
          <ion-input
            label="Nombre del sitio"
            labelPlacement="stacked"
            type="text"
            placeholder="Nombre sitio"
            [(ngModel)]="name"
            (ionInput)="onInputChange($event, 'name')"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-input
            label="Tipo de sitio"
            labelPlacement="stacked"
            type="text"
            placeholder="Tipo sitio"
            [(ngModel)]="type"
            (ionInput)="onInputChange($event, 'type')"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-input
            label="Descripcion del sitio"
            labelPlacement="stacked"
            type="text"
            placeholder="Descripción sitio"
            [(ngModel)]="description"
            (ionInput)="onInputChange($event, 'description')"
          ></ion-input>
        </ion-item>
        <ion-item >
          <ion-select
            label="País"
            labelPlacement="stacked"
            placeholder="Selecciona un país"
            [(ngModel)]="countryId"
            (ionChange)="searchCity($event)"
          >
          @for (pais of paises; track pais.id) {
            <ion-select-option [value]="pais.id">{{ pais.name }}</ion-select-option>
          }
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-select
            label="Ciudad"
            labelPlacement="stacked"
            placeholder="Selecciona una ciudad"
            [(ngModel)]="cityId"
          >
             @for (ciudad of ciudades; track ciudad.id) {
            <ion-select-option [value]="ciudad.id">{{ ciudad.name }}</ion-select-option>
          }
          </ion-select>
        </ion-item>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>

<ion-content class="ion-padding">
  <ion-modal #modalVisita (willDismiss)="onWillDismiss($event)">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="start">
            <ion-button (click)="cancelVisita()">Cancelar</ion-button>
          </ion-buttons>
          <ion-title>Visita</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="confirmVisita()" [strong]="true">Confirmar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-item>
          <ion-datetime 
          presentation="date"
          [(ngModel)]="fechaVisita"
          (ionChange)="onFechaChange($event)"
          placeholder="Selecciona una fecha"
          ></ion-datetime>
        </ion-item>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>

<ion-content class="ion-padding">
  <ion-modal  #modalPlato (willDismiss)="onWillDismiss($event)">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="start">
            <ion-button (click)="cancelPlato()">Cancelar</ion-button>
          </ion-buttons>
          <ion-title>Plato</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="confirmPlato()" [strong]="true">Confirmar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-item>
          <ion-input
            label="Nombre del plato"
            labelPlacement="stacked"
            type="text"
            placeholder="Nombre plato"
            [(ngModel)]="platoName"
            (ionInput)="onInputChange($event, 'platoName')"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-input
            label="Precio del plato"
            labelPlacement="stacked"
            type="number"
            placeholder="Precio plato"
            [(ngModel)]="platoPrice"
            (ionInput)="onInputChange($event, 'platoPrice')"
          ></ion-input>
        </ion-item>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>

<ion-content class="ion-padding">
  <ion-modal  #modalTag (willDismiss)="onWillDismiss($event)">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="start">
            <ion-button (click)="cancelTag()">Cancelar</ion-button>
          </ion-buttons>
          <ion-title>Tag</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="confirmTag()" [strong]="true">Confirmar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-button (click)="takePhoto()" style="margin: 10px 0; margin-left: 10px;">Tomar foto</ion-button>
        <ion-button (click)="geolocalizar()" style="margin: 10px 0; margin-left: 10px;">Geolocalizar</ion-button>
        <pre>Lat: {{ latitude }} | Lng: {{ longitude }}</pre>
        <ion-item>
          <ion-input
            label="Latitude"
            labelPlacement="stacked"
            type="text"
            placeholder="Latitude"
            [(ngModel)]="latitude"
            disabled = "true"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-input
            label="Longitude"
            labelPlacement="stacked"
            type="text"
            placeholder="Longitude"
            [(ngModel)]="longitude"
            disabled = "true"
          ></ion-input>
        </ion-item>
        @if (imageUrl) {
          <ion-item>
            <img [src]="imageUrl" alt="Foto del sitio" style="width: 100%; height: auto;"/>
          </ion-item>
        }
         <ion-item>
        <ion-select label="Famoso" label-placement="floating">
          @if(famosos.length > 0) {
            @for (famoso of famosos; track famoso.id) {
              <ion-select-option [value]="famoso.id">{{ famoso.name }}</ion-select-option>
            }
          } @else {
            <ion-select-option disabled>No hay famosos disponibles</ion-select-option>
          }
        </ion-select>
      </ion-item>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
</ion-content>
